(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{309:(e,t,i)=>{Promise.resolve().then(i.bind(i,6717))},6717:(e,t,i)=>{"use strict";i.d(t,{default:()=>m});var n=i(2311);class s{on(e,t){this.eventListeners.set(e,t)}off(e){this.eventListeners.delete(e)}emit(e,t){let i=this.eventListeners.get(e);i&&i(t)}setWarningEnabled(e){this.isWarningEnabled=e,e?this.isMonitoring&&this.startWarningTimer():this.stopWarningTimer()}setWarningThreshold(e){this.warningThreshold=e,this.isMonitoring&&this.isWarningEnabled&&this.restartWarningTimer()}startMonitoring(){if(this.isMonitoring)return void console.log("Monitoring is already active.");this.isMonitoring=!0,this.hasWarned=!1,console.log("Starting monitoring..."),this.sensor.listen("blinkDetected",this.handleBlinkDetected),this.startWarningTimer()}stopMonitoring(){if(!this.isMonitoring)return void console.log("Monitoring is not active.");this.isMonitoring=!1,console.log("Stopping monitoring..."),this.sensor.off("blinkDetected"),this.stopWarningTimer()}startWarningTimer(){this.isWarningEnabled&&(this.stopWarningTimer(),this.warningTimer=setTimeout(()=>{this.isMonitoring&&!this.hasWarned&&(this.warning.makeWarning("깜빡임이 ".concat(this.warningThreshold,"초 이상 없습니다. 눈을 깜빡여주세요.")),this.hasWarned=!0)},1e3*this.warningThreshold))}stopWarningTimer(){this.warningTimer&&(clearTimeout(this.warningTimer),this.warningTimer=null)}restartWarningTimer(){this.stopWarningTimer(),this.startWarningTimer()}constructor(e,t){this.sensor=e,this.warning=t,this.isMonitoring=!1,this.lastBlinkTime=performance.now(),this.eventListeners=new Map,this.isWarningEnabled=!0,this.warningThreshold=5,this.warningTimer=null,this.hasWarned=!1,this.handleBlinkDetected=e=>{let t=(e-this.lastBlinkTime)/1e3;this.lastBlinkTime=e,console.log("마지막 깜빡임으로부터 경과된 시간: ".concat(t.toFixed(2),"초")),this.hasWarned=!1,this.restartWarningTimer(),this.emit("blinkDetected",{elapsedSeconds:t,timestamp:e,lastBlinkTime:this.lastBlinkTime})}}}class r{getCurrentValue(){return 0}async listen(e,t){this.listeners.set(e,t),this.isWorkerMode||await this.startWorkerMode()}async off(e){this.listeners.delete(e),0===this.listeners.size&&this.destructor()}async startWorkerMode(){if(this.isWorkerMode)return void console.warn("워커 모드가 이미 활성화되어 있습니다.");try{this.startVideoStream(),this.worker=await this.createWorker(),this.isWorkerMode=!0}catch(e){throw console.error("워커 모드 시작 실패:",e),this.destructor(),e}}startVideoStream(){navigator.mediaDevices.getUserMedia({video:!0}).then(e=>{this.videoElement.srcObject=e,this.videoElement.play().then(()=>{}).catch(e=>{console.warn("비디오 재생 실패:",e)})})}async createWorker(){try{let e=new Worker(i.tu(new URL(i.p+i.u(381),i.b)),{type:void 0});return e.onmessage=e=>this.handleWorkerMessage(e),e.onerror=e=>{console.error("워커 에러:",e)},e.postMessage({type:"initialize",data:{modelPath:"/face_landmarker.task"}}),e}catch(e){throw console.error("워커 생성 실패:",e),e}}handleWorkerMessage(e){let{type:t,data:i}=e.data;switch(t){case"requestVideoFrame":this.sendingVideoFrame();break;case"eyeStatus":this.isBlink(i.status)&&this.notifyListeners("blinkDetected",this.lastBlinkTime);break;case"error":console.error("워커 오류:",i.message)}}sendingVideoFrame(){if(this.worker&&(this.canvas||this.initCanvas(),this.updateCanvasSize(),this.canvas&&this.ctx)){this.ctx.drawImage(this.videoElement,0,0);let e=this.ctx.getImageData(0,0,this.canvas.width,this.canvas.height);this.worker.postMessage({type:"getEyeStatus",data:{videoData:e,timestamp:performance.now()}})}}initCanvas(){this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d")}updateCanvasSize(){this.canvas&&this.videoElement.videoWidth>0&&(this.canvas.width=this.videoElement.videoWidth,this.canvas.height=this.videoElement.videoHeight)}isBlink(e){let t=e>this.blinkLimitScore?"close":"open";if("open"===this.eyeStatus&&"close"===t)this.eyeStatus="close";else if("close"===this.eyeStatus&&"open"===t)return this.eyeStatus="open",this.lastBlinkTime=performance.now(),!0;return!1}destructor(){null!==this.animationFrameId&&(window.cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),this.videoElement&&(this.videoElement.pause(),this.videoElement.srcObject=null),this.worker&&(this.worker.terminate(),this.worker=null),this.canvas&&(this.canvas.width=0,this.canvas.height=0,this.canvas=null,this.ctx=null),this.isWorkerMode=!1}notifyListeners(e,t){let i=this.listeners.get(e);i&&i(t)}constructor(e){this.videoElement=e,this.animationFrameId=null,this.listeners=new Map,this.worker=null,this.isWorkerMode=!1,this.canvas=null,this.ctx=null,this.eyeStatus="open",this.blinkLimitScore=.4,this.lastBlinkTime=0}}class a{makeWarning(e){if(!this.isSupported||!this.audioContext)return void console.warn("Web Audio API is not supported in this browser");this.playBlinkSound(),console.log("깜빡임 경고음 재생: ".concat(e))}playBlinkSound(){if(!this.audioContext)return;let e=this.audioContext.createOscillator(),t=this.audioContext.createGain();e.type="sine",e.frequency.setValueAtTime(400,this.audioContext.currentTime),e.frequency.exponentialRampToValueAtTime(600,this.audioContext.currentTime+.1),t.gain.setValueAtTime(0,this.audioContext.currentTime),t.gain.linearRampToValueAtTime(.3,this.audioContext.currentTime+.05),t.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.3),e.connect(t),t.connect(this.audioContext.destination),e.start(this.audioContext.currentTime),e.stop(this.audioContext.currentTime+.3),setTimeout(()=>{let e=this.audioContext.createOscillator(),t=this.audioContext.createGain();e.type="sine",e.frequency.setValueAtTime(600,this.audioContext.currentTime),e.frequency.exponentialRampToValueAtTime(300,this.audioContext.currentTime+.08),t.gain.setValueAtTime(0,this.audioContext.currentTime),t.gain.linearRampToValueAtTime(.2,this.audioContext.currentTime+.04),t.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.25),e.connect(t),t.connect(this.audioContext.destination),e.start(this.audioContext.currentTime),e.stop(this.audioContext.currentTime+.25)},150)}triggerBlinkWarning(e){this.makeWarning("깜빡임 간격이 ".concat(e.toFixed(1),"초입니다."))}triggerEyeHealthWarning(){this.makeWarning("눈 건강을 위해 잠시 휴식을 취해주세요.")}constructor(){this.audioContext=null,this.isSupported=!1,this.isSupported="AudioContext"in window||"webkitAudioContext"in window,this.isSupported&&(this.audioContext=new(window.AudioContext||window.webkitAudioContext))}}var o=i(2847);let l=(0,o.memo)(function(e){let{videoRef:t,isRunning:i}=e,s=(0,o.useMemo)(()=>i?"border-blue-400 shadow-lg":"border-gray-200 bg-gray-50",[i]),r=(0,o.useMemo)(()=>i?1:.3,[i]);return(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)("video",{ref:t,className:"w-full h-40 object-cover rounded-2xl border-2 transition-all duration-300 ".concat(s),style:{opacity:r}}),!i&&(0,n.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"text-3xl mb-1",children:"\uD83D\uDCF9"}),(0,n.jsx)("p",{className:"text-gray-500 text-xs",children:"카메라를 시작해주세요"})]})})]})});function c(e){let{lastBlinkInterval:t}=e;return(0,n.jsx)("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 rounded-2xl p-3 border border-green-100",children:(0,n.jsx)("div",{className:"flex items-center justify-between",children:(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-xs text-green-600 font-medium",children:"마지막 깜빡임 간격"}),(0,n.jsx)("p",{className:"text-xl font-bold text-green-700",children:t?"".concat(t.toFixed(1),"초"):"--"})]})})})}let h=(0,o.memo)(function(e){let{isWarningEnabled:t,warningThreshold:i,onToggleWarning:s,onUpdateThreshold:r}=e,a=(0,o.useMemo)(()=>t?"bg-orange-500":"bg-gray-300",[t]),l=(0,o.useMemo)(()=>t?"translate-x-6":"translate-x-1",[t]);return(0,n.jsx)("div",{className:"bg-gradient-to-r from-orange-50 to-amber-50 rounded-2xl p-3 border border-orange-100",children:(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)("span",{className:"text-xs text-orange-600 font-medium",children:"소리 경고"}),(0,n.jsx)("button",{onClick:s,className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors ".concat(a),children:(0,n.jsx)("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform ".concat(l)})})]}),(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)("span",{className:"text-xs text-orange-600 font-medium",children:"경고 임계값"}),(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)("button",{onClick:()=>r(Math.max(1,i-1)),className:"w-6 h-6 rounded-full bg-orange-200 text-orange-600 text-xs font-bold hover:bg-orange-300",children:"-"}),(0,n.jsxs)("span",{className:"text-xs font-medium text-orange-700 min-w-[2rem] text-center",children:[i,"초"]}),(0,n.jsx)("button",{onClick:()=>r(i+1),className:"w-6 h-6 rounded-full bg-orange-200 text-orange-600 text-xs font-bold hover:bg-orange-300",children:"+"})]})]})]})})}),d=(0,o.memo)(function(e){let{isRunning:t}=e,i=(0,o.useMemo)(()=>t?"모니터링 중...":"대기 중",[t]),s=(0,o.useMemo)(()=>t?"bg-green-500 animate-pulse":"bg-gray-300",[t]);return(0,n.jsxs)("div",{className:"flex items-center justify-center space-x-2",children:[(0,n.jsx)("div",{className:"w-2 h-2 rounded-full ".concat(s)}),(0,n.jsx)("span",{className:"text-xs text-gray-600",children:i})]})}),u=(0,o.memo)(function(e){let{isRunning:t,onStart:i,onStop:s}=e,r=(0,o.useMemo)(()=>t?"모니터링 중지":"모니터링 시작",[t]),a=(0,o.useMemo)(()=>t?"⏹️":"▶️",[t]),l=(0,o.useMemo)(()=>t?"bg-red-500 hover:bg-red-600 text-white shadow-lg shadow-red-200":"bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 text-white shadow-lg shadow-blue-200",[t]);return(0,n.jsx)("button",{className:"w-full py-3 rounded-2xl font-semibold text-base transition-all duration-300 transform active:scale-95 ".concat(l),onClick:t?s:i,children:(0,n.jsxs)("span",{className:"flex items-center justify-center space-x-2",children:[(0,n.jsx)("span",{children:a}),(0,n.jsx)("span",{children:r})]})})});function m(){let{videoRef:e,isRunning:t,lastBlinkInterval:i,isWarningEnabled:m,warningThreshold:g,toggleWarning:x,updateWarningThreshold:p,handleStart:v,handleStop:w}=function(){let e=(0,o.useRef)(null),[t,i]=(0,o.useState)(!1),[n,l]=(0,o.useState)(0),[c,h]=(0,o.useState)(!0),[d,u]=(0,o.useState)(5),m=(0,o.useRef)(null),g=(0,o.useCallback)(()=>{if(null===m.current){let t=new a;e.current&&(m.current=new s(new r(e.current),t),m.current.on("blinkDetected",e=>{l(e.elapsedSeconds)}))}m.current&&(i(!0),m.current.startMonitoring())},[]),x=(0,o.useCallback)(()=>{m.current&&(i(!1),m.current.stopMonitoring())},[]),p=(0,o.useCallback)(()=>{let e=!c;h(e),m.current&&m.current.setWarningEnabled(e)},[c]),v=(0,o.useCallback)(e=>{u(e),m.current&&m.current.setWarningThreshold(e)},[]),w=(0,o.useCallback)(()=>{e.current?g():console.error("비디오 요소가 준비되지 않았습니다.")},[g]),b=(0,o.useCallback)(()=>{x()},[x]);return(0,o.useMemo)(()=>({videoRef:e,isRunning:t,start:g,stop:x,lastBlinkInterval:n,isWarningEnabled:c,toggleWarning:p,warningThreshold:d,updateWarningThreshold:v,handleStart:w,handleStop:b}),[e,t,g,x,n,c,p,d,v,w,b])}();return(0,n.jsxs)("div",{className:"w-full max-w-md bg-white rounded-3xl shadow-2xl overflow-hidden",children:[(0,n.jsxs)("div",{className:"p-6 space-y-4",children:[(0,n.jsx)(l,{videoRef:e,isRunning:t}),(0,n.jsx)(c,{lastBlinkInterval:i}),(0,n.jsx)(h,{isWarningEnabled:m,warningThreshold:g,onToggleWarning:x,onUpdateThreshold:p}),(0,n.jsx)(d,{isRunning:t})]}),(0,n.jsx)("div",{className:"px-6 pb-6",children:(0,n.jsx)(u,{isRunning:t,onStart:v,onStop:w})})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[789,20,358],()=>t(309)),_N_E=e.O()}]);